# OPA Boundary — Phase 1

This document defines the **strict architectural boundary** between the Policy Engine and OPA Gatekeeper.

Its purpose is to prevent role confusion, uncontrolled complexity, and accidental delegation of architectural decisions to a runtime evaluator.

OPA is a powerful enforcement tool.  
It is **not** a policy engine.

---

## 1. Purpose of This Boundary

The Policy Engine is responsible for **policy engineering**.  
OPA Gatekeeper is responsible for **policy enforcement**.

These responsibilities must never overlap.

If the boundary is violated:
- decisions become opaque
- policies become inconsistent
- audits become indefensible
- enforcement logic becomes unmaintainable

This boundary is **intentional and non-negotiable**.

---

## 2. What OPA Gatekeeper Is

OPA Gatekeeper is a **runtime policy evaluation engine**.

It:
- evaluates individual Kubernetes objects
- answers binary questions (allow / deny)
- applies constraints deterministically
- emits violation information

OPA operates **without architectural context**.

---

## 3. What OPA Gatekeeper Is Not

OPA Gatekeeper is **not**:

- an architecture analysis tool
- a risk assessment engine
- a standards interpretation engine
- a control selection engine
- a remediation engine
- a reporting engine

OPA does not understand:
- why a policy exists
- whether a control should apply
- what business context exists
- what alternatives are acceptable

---

## 4. Role of the Policy Engine

The Policy Engine is the **strategy layer**.

It is solely responsible for deciding:

- which security controls apply
- why those controls apply
- what risk they mitigate
- how strict enforcement should be
- which exceptions are legitimate
- how controls map to standards
- how enforcement differs per platform

OPA is never allowed to infer or override these decisions.

---

## 5. Decision Ownership Matrix

| Decision Type                               | Owner            |
|--------------------------------------------|------------------|
| Control applicability                      | Policy Engine    |
| Risk classification                        | Policy Engine    |
| Severity assignment                        | Policy Engine    |
| Standards mapping                          | Policy Engine    |
| Exception justification                   | Policy Engine    |
| Enforcement intent (deny / report)         | Policy Engine    |
| Platform translation                      | Policy Engine    |
| Object-level allow / deny decision         | OPA Gatekeeper   |
| Constraint evaluation                      | OPA Gatekeeper   |
| Violation event generation                | OPA Gatekeeper   |

No exceptions to this matrix are allowed in Phase 1.

---

## 6. Information Flow Between Engine and OPA

```

Policy Engine Output:

* Control identifier
* Enforcement intent
* Target scope
* Parameters
* Explicit exceptions
* Traceability metadata

  ```
        ↓ GENERATES ↓
  ```

OPA Gatekeeper Artifacts:

* ConstraintTemplates (static library)
* Constraints (parameterized instances)
* Metadata annotations

  ```
        ↓ OPA EVALUATES ↓
  ```

Runtime Objects:

* Admission requests
* Allow / deny outcomes
* Violation events

```

OPA consumes **decisions**, not **context**.

---

## 7. Constraint Generation Model

In Phase 1:

- ConstraintTemplates are maintained as a **controlled library**
- The Policy Engine generates **Constraints only**
- Rego logic is not dynamically generated per execution

This ensures:
- reviewability
- stability
- security of enforcement logic

---

## 8. Metadata and Traceability

OPA artifacts generated by the engine include metadata describing:

- control identifier
- severity
- standards references
- rationale
- engine version
- generation timestamp

Metadata serves **traceability and audit**, not enforcement logic.

OPA must never:
- interpret metadata
- alter enforcement based on metadata
- derive decisions from metadata

---

## 9. Exception Handling Rules

Exceptions are **policy decisions**, not enforcement heuristics.

The Policy Engine:
- decides if an exception exists
- defines its scope and justification
- encodes it explicitly in constraint parameters

OPA:
- applies exceptions mechanically
- never invents or infer exemptions
- never evaluates exception validity

Self-service exemptions via workload labels are explicitly disallowed.

---

## 10. What Must Never Be Delegated to OPA

The following decisions must **never** be made inside Rego or OPA logic:

- whether a control applies
- how risky a component is
- whether a standard is satisfied holistically
- whether an exception is acceptable
- how compliance is measured globally
- how remediation should occur
- how controls map across platforms

If a decision requires understanding **why**, it belongs in the Policy Engine.

---

## 11. What OPA Is Allowed to Decide

OPA is allowed to decide only:

- whether a specific object violates a specific constraint
- whether an admission request should be denied
- which violation message to emit

These decisions are local, binary, and context-free.

---

## 12. Reporting Boundary

OPA violation events:
- are inputs to reporting
- are not authoritative on compliance
- do not represent overall posture

The Policy Engine aggregates and interprets enforcement results.

---

## 13. Failure Modes and Safety

If OPA is unavailable or misconfigured:
- the Policy Engine still produces a complete control plan
- enforcement is reported as unavailable
- no decisions are silently skipped

OPA failure never results in implicit compliance.

---

## 14. Future Considerations

Later phases may:
- support additional enforcement backends
- reuse the same boundary model
- extend metadata usage for audit

The boundary defined here must remain unchanged.

---

## 15. Summary

OPA Gatekeeper is a **tactical enforcement engine**.

The Policy Engine is a **strategic decision system**.

Their separation ensures:
- clarity of responsibility
- explainability of decisions
- maintainability of policy logic
- extensibility across platforms

Violating this boundary undermines the entire design.
